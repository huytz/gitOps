# TEMPLATE CUSTOMIZATION REQUIRED:
# After forking this template, update the following:
# - Line 4: repository - Replace 'ghcr.io/huytz/webapp' with your container image
# See ../../../docs/CUSTOMIZATION.md for detailed instructions.

applicationName: webapp
replicaCount: 1
containerImage:
  repository: ghcr.io/huytz/webapp  # TODO: Update with your container registry
  tag: main-e785142
  pullPolicy: IfNotPresent
containerPorts:
  http:
    port: 3000
    protocol: TCP
service:
  ports:
    app:
      port: 80
      targetPort: http
      protocol: TCP

ingress:
  enabled: false


# Override the container command to source the Vault secrets
# containerCommand: ["/bin/bash", "-c"]
# containerArgs: ["source /vault/secrets/config && exec docker-php-entrypoint apache2-foreground"]

# Service Account configuration for Vault auth
serviceAccount:
  create: true
  name: webapp
  annotations:
    vault.hashicorp.com/role: "default_webapp"
  labels:
    app: webapp
    vault-auth: "true"

# Vault agent injection configuration
podAnnotations:
  vault.hashicorp.com/agent-inject: "true"
  vault.hashicorp.com/agent-inject-status: "update"
  vault.hashicorp.com/role: "default_webapp"
  vault.hashicorp.com/agent-inject-secret-config: "secrets/data/development/default/webapp"
  vault.hashicorp.com/secret-volume-path-config: "/vault/secrets"
  vault.hashicorp.com/agent-inject-template-config: |
    {{- with secret "secrets/data/development/default/webapp" -}}
    {{- range $k, $v := .Data.data -}}
    export {{ $k }}="{{ $v }}"{{ "\n" -}}
    {{- end -}}
    {{- end }}
