applicationName: webapp
replicaCount: 1
containerImage:
  repository: ghcr.io/huytz/webapp
  tag: main-e785142
  pullPolicy: IfNotPresent
containerPort: 3000
service:
  type: ClusterIP
  port: 3000
ingress:
  enabled: false


# Override the container command to source the Vault secrets
# containerCommand: ["/bin/bash", "-c"]
# containerArgs: ["source /vault/secrets/config && exec docker-php-entrypoint apache2-foreground"]

# Service Account configuration for Vault auth
serviceAccount:
  create: true
  name: webapp
  annotations:
    vault.hashicorp.com/role: "default_webapp"
  labels:
    app: webapp
    vault-auth: "true"

# Vault agent injection configuration
podAnnotations:
  vault.hashicorp.com/agent-inject: "true"
  vault.hashicorp.com/agent-inject-status: "update"
  vault.hashicorp.com/role: "default_webapp"
  vault.hashicorp.com/agent-inject-secret-config: "secrets/data/development/default/webapp"
  vault.hashicorp.com/secret-volume-path-config: "/vault/secrets"
  vault.hashicorp.com/agent-inject-template-config: |
    {{- with secret "secrets/data/development/default/webapp" -}}
    {{- range $k, $v := .Data.data -}}
    export {{ $k }}="{{ $v }}"{{ "\n" -}}
    {{- end -}}
    {{- end }}
